<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASVAuto Settings Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f9f9f9; }
    h1 { color: #333; }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    input { padding: 0.5rem; width: 100%; max-width: 200px; }
    .output { margin-top: 2rem; background: #fff; padding: 1rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ASVAuto Settings Calculator</h1>

  <label for="epapMin">Desired Min EPAP</label>
  <input type="number" step="0.2" id="epapMin" />

  <label for="epapMax">Desired Max EPAP</label>
  <input type="number" step="0.2" id="epapMax" />

  <label for="psMin">Desired Min PS</label>
  <input type="number" step="0.2" id="psMin" />

  <label for="psMax">Desired Max PS</label>
  <input type="number" step="0.2" id="psMax" />

  <div class="output">
    <h3>Machine Settings Output</h3>
    <div id="result"></div>
  </div>

  <script>
    const epapMinInput = document.getElementById("epapMin");
    const epapMaxInput = document.getElementById("epapMax");
    const psMinInput = document.getElementById("psMin");
    const psMaxInput = document.getElementById("psMax");
    const resultDiv = document.getElementById("result");

    const validateAndDisplay = () => {
      const epapMin = parseFloat(epapMinInput.value);
      const epapMax = parseFloat(epapMaxInput.value);
      const psMin = parseFloat(psMinInput.value);
      const psMax = parseFloat(psMaxInput.value);

      let errors = [];

      if (isNaN(epapMin) || epapMin < 4 || epapMin > 15) {
        errors.push("Min EPAP must be between 4 and 15.");
      }
      if (isNaN(epapMax) || epapMax < epapMin || epapMax > 15) {
        errors.push("Max EPAP must be between Min EPAP and 15.");
      }
      if (isNaN(psMin) || psMin < 0 || psMin > 6) {
        errors.push("Min PS must be between 0 and 6.");
      }
      if (isNaN(psMax) || psMax < psMin) {
        errors.push("Max PS must be greater than or equal to Min PS.");
      }

      let maxPsCap = 20;
      if (epapMin === 15 && epapMax === 15) {
        maxPsCap = 10;
        if (psMin > 5) errors.push("When EPAP Min/Max is 15, PS Min is capped at 5.");
      }

      if (psMax > maxPsCap) {
        errors.push(`Max PS capped at ${maxPsCap} based on current EPAP Min/Max.`);
      }

      if (errors.length > 0) {
        resultDiv.innerHTML = '<div class="error">' + errors.join("<br>") + '</div>';
        return;
      }

      resultDiv.innerHTML = `
        <strong>Validated Machine Settings:</strong><br>
        Min EPAP: ${epapMin.toFixed(1)}<br>
        Max EPAP: ${epapMax.toFixed(1)}<br>
        Min PS: ${psMin.toFixed(1)}<br>
        Max PS: ${Math.min(psMax, maxPsCap).toFixed(1)}
      `;
    };

    epapMinInput.addEventListener("input", validateAndDisplay);
    epapMaxInput.addEventListener("input", validateAndDisplay);
    psMinInput.addEventListener("input", validateAndDisplay);
    psMaxInput.addEventListener("input", validateAndDisplay);
  </script>
</body>
</html>
