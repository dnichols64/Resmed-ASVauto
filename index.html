function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}

function roundToIncrement(value, increment = 0.2) {
  return Math.round(value / increment) * increment;
}

function getASVAutoMachineValues(desiredEpapMin, desiredEpapMax, desiredPsMin, desiredPsMax) {
  // Round and clamp EPAP Min and Max
  let epapMin = clamp(roundToIncrement(desiredEpapMin, 0.2), 4.0, 15.0);
  let epapMax = clamp(roundToIncrement(desiredEpapMax, 0.2), epapMin, 15.0);

  // Initialize PS Min and PS Max clamping boundaries
  let psMinMaxAllowed = 6; // default max ps min
  let psMaxAllowedMin = 5; // default min ps max lower bound
  let psMaxAllowedMax = 20; // default max ps max upper bound

  // Special case: if EPAP Min = EPAP Max = 15
  if (epapMin === 15 && epapMax === 15) {
    psMinMaxAllowed = 5;   // PS Min max is 5
    psMaxAllowedMin = 10;  // PS Max fixed at 10
    psMaxAllowedMax = 10;
  } else {
    // Other cases: define allowed PS ranges based on your test data
    // For example, when EPAP Min is less than 15
    // I’m filling example logic — you should replace with your tested caps/ranges

    // If EPAP Min < 15, PS Min max 6
    psMinMaxAllowed = 6;

    // PS Max min varies based on EPAP Min and PS Min from your data
    // Placeholder example: if PS Min < 3, min PS Max is 5; else min PS Max is 8
    psMaxAllowedMin = desiredPsMin < 3 ? 5 : 8;

    // PS Max max capped by EPAP Min and PS Min (you should adjust this with real rules)
    psMaxAllowedMax = 20;

    // Example cap based on EPAP Min and PS Min
    if (epapMin >= 12 && desiredPsMin >= 3) {
      psMaxAllowedMax = 13;
    } else if (epapMin >= 10 && desiredPsMin >= 5) {
      psMaxAllowedMax = 15;
    }
  }

  // Clamp PS Min and PS Max according to allowed ranges
  let psMin = clamp(Math.floor(desiredPsMin), 0, psMinMaxAllowed);
  let psMax = clamp(Math.floor(desiredPsMax), Math.max(psMin, psMaxAllowedMin), psMaxAllowedMax);

  // PS Min cannot be greater than PS Max
  if (psMin > psMax) psMin = psMax;

  return {
    epapMin,
    epapMax,
    psMin,
    psMax
  };
}

// Example usage:

const input = {
  epapMin: 10,
  epapMax: 15,
  psMin: 3,
  psMax: 13
};

const machineValues = getASVAutoMachineValues(input.epapMin, input.epapMax, input.psMin, input.psMax);
console.log('Adjusted machine values:', machineValues);
